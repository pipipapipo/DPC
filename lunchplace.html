<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Where to eat for lunch</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#22d3ee; --accent2:#14b8a6; --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
    background: radial-gradient(1200px 800px at 20% -10%, #1e293b 0%, #0b1220 50%, #070b14 100%), var(--bg);
    color:var(--text); min-height:100svh; display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .wrap{width:min(960px,100%); display:grid; gap:14px}
  .card{
    background: linear-gradient(180deg,#0c1424,#0b1020);
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius); padding:16px;
  }
  h1{margin:0 0 6px; font-size:clamp(22px,3.5vw,32px)}
  p.muted{margin:0 0 12px; color:var(--muted)}
  .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .btn{
    appearance:none; border:0; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:700;
    background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#041016;
  }
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .secondary{
    background:#0d1322; color:var(--text); border:1px solid rgba(255,255,255,.1);
  }
  .row{display:grid; gap:14px}
  @media (min-width: 860px){ .row.cols-2{ grid-template-columns: 1fr 1fr; } }
  textarea{
    width:100%; min-height:120px; resize:vertical; border-radius:12px; padding:12px; color:var(--text);
    background:#0d1322; border:1px solid rgba(255,255,255,.08); outline:none;
  }
  .wheel-wrap{ position:relative; display:grid; place-items:center; }
  canvas{ width:min(92vw,460px); height:min(92vw,460px); max-width:460px; max-height:460px; display:block }
  /* Pointer arrow at the top (12 o'clock) */
  .pointer{
    position:absolute; top:-6px; width:0; height:0; border-left:12px solid transparent; border-right:12px solid transparent;
    border-bottom:20px solid #fef08a; filter:drop-shadow(0 3px 3px rgba(0,0,0,.35));
  }
  .result{ text-align:center; margin-top:10px; }
  .result h2{ margin:.3rem 0 .1rem; font-size:clamp(20px,3vw,26px)}
  .result .muted{ color:var(--muted) }
</style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Lunch RNG ‚Äî Spinning Wheel üçú</h1>
      <p class="muted">Edit your list, then hit <b>Spin</b>. Winner is under the arrow.</p>
      <div class="controls">
        <button id="spinBtn" class="btn">üé≤ Spin</button>
        <button id="shuffleBtn" class="btn secondary">Shuffle colors</button>
        <span id="count" class="muted" style="margin-left:6px"></span>
      </div>
    </section>

    <section class="row cols-2">
      <div class="card">
        <div class="wheel-wrap">
          <div class="pointer" aria-hidden="true"></div>
          <canvas id="wheel" width="920" height="920" aria-label="Lunch spinner"></canvas>
        </div>
        <div class="result" id="result" style="display:none">
          <div class="muted">Result</div>
          <h2 id="winnerText">‚Äî</h2>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:.2rem 0 .6rem">Places (comma-separated)</h3>
        <!-- EDIT THIS LIST: one line, comma-separated, no quotes -->
        <textarea id="listInput">Din Tai Fung, Sushi Express, Tenderfresh, Ban Mian Stall, Ramen Keisuke, Toast Box, Prata Place, Don Don Donki Bento</textarea>
        <div class="controls">
          <button id="updateBtn" class="btn">Update List</button>
          <button id="clearBtn" class="btn secondary">Clear</button>
          <span class="muted">Saved in your browser.</span>
        </div>
      </div>
    </section>
  </main>

<script>
(() => {
  // ---------- State ----------
  const WHEEL = document.getElementById('wheel');
  const CTX   = WHEEL.getContext('2d');
  const DPR   = window.devicePixelRatio || 1;

  // Scale for crisp canvas on high DPI
  function fitCanvas() {
    const cssSize = Math.min(window.innerWidth*0.92, 460);
    WHEEL.style.width  = cssSize + 'px';
    WHEEL.style.height = cssSize + 'px';
    WHEEL.width  = Math.round(cssSize * DPR);
    WHEEL.height = Math.round(cssSize * DPR);
  }
  fitCanvas(); window.addEventListener('resize', fitCanvas);

  const spinBtn    = document.getElementById('spinBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const listInput  = document.getElementById('listInput');
  const updateBtn  = document.getElementById('updateBtn');
  const clearBtn   = document.getElementById('clearBtn');
  const resultBox  = document.getElementById('result');
  const winnerText = document.getElementById('winnerText');
  const countEl    = document.getElementById('count');

  const STORAGE_KEY = 'lunch_rng_wheel_v1';
  let items = load() || parseList(listInput.value);
  let rotation = 0;        // radians
  let spinning = false;
  let paletteSeed = Math.random();

  function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)); } catch { return null; } }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }

  function parseList(s) {
    return s.split(',').map(t => t.trim()).filter(Boolean);
  }

  function updateListFromTextarea(){
    items = parseList(listInput.value);
    save();
    countEl.textContent = `${items.length} items`;
    draw();
  }

  // ---------- Drawing ----------
  function colorFor(i, n, seed=0) {
    // Nice distinct colors around the wheel
    const h = ( (i/n) * 360 + seed*360 ) % 360;
    return `hsl(${h} 75% 55%)`;
  }

  function draw() {
    const w = WHEEL.width, h = WHEEL.height;
    const cx = w/2, cy = h/2;
    const r  = Math.min(cx, cy) - 8*DPR;
    CTX.clearRect(0,0,w,h);

    if (items.length === 0) {
      CTX.fillStyle = '#94a3b8';
      CTX.font = `${16*DPR}px system-ui, sans-serif`;
      CTX.textAlign = 'center';
      CTX.fillText('Add some places to spin!', cx, cy);
      return;
    }

    const arc = (Math.PI * 2) / items.length;

    // draw segments
    for (let i=0; i<items.length; i++){
      const start = rotation - Math.PI/2 + i*arc;
      const end   = start + arc;

      // slice
      CTX.beginPath();
      CTX.moveTo(cx, cy);
      CTX.arc(cx, cy, r, start, end);
      CTX.closePath();
      CTX.fillStyle = colorFor(i, items.length, paletteSeed);
      CTX.fill();

      // separator line
      CTX.strokeStyle = 'rgba(255,255,255,.15)';
      CTX.lineWidth = 1.2*DPR;
      CTX.beginPath();
      CTX.moveTo(cx, cy);
      CTX.arc(cx, cy, r, start, start);
      CTX.stroke();

      // label
      CTX.save();
      CTX.translate(cx, cy);
      CTX.rotate((start + end)/2);
      CTX.textAlign = 'right';
      CTX.fillStyle = '#0b1020';
      CTX.font = `bold ${Math.max(12, Math.min(18, r/10))*DPR}px system-ui, sans-serif`;
      const text = items[i];
      const maxText = 26;
      const label = text.length > maxText ? text.slice(0, maxText-1)+'‚Ä¶' : text;
      CTX.fillText(label, r - 12*DPR, 6*DPR);
      CTX.restore();
    }

    // center hub
    CTX.beginPath();
    CTX.arc(cx, cy, 36*DPR, 0, Math.PI*2);
    CTX.fillStyle = '#0b1020';
    CTX.fill();
    CTX.lineWidth = 2*DPR;
    CTX.strokeStyle = 'rgba(255,255,255,.18)';
    CTX.stroke();
  }

  // ---------- Spin ----------
  function spin(){
    if (spinning || items.length === 0) return;
    spinning = true; spinBtn.disabled = true;
    resultBox.style.display = 'none';

    const n = items.length;
    const arc = (Math.PI*2)/n;

    // Pick a winner index, compute a satisfying final angle so its center lands at the pointer (12 o‚Äôclock)
    const k = Math.floor(Math.random()*n);
    const rounds = 4 + Math.floor(Math.random()*3); // 4‚Äì6 full spins
    const target = rounds * Math.PI * 2 + (2*Math.PI - (k + 0.5) * arc); // see derivation in analysis

    const start = rotation;
    const delta = target - start;
    const duration = 2200 + Math.random()*800; // 2.2‚Äì3.0s
    const t0 = performance.now();

    (function animate(now){
      const t = Math.min(1, (now - t0)/duration);
      const easeOut = 1 - Math.pow(1 - t, 3); // cubic-out
      rotation = start + delta * easeOut;
      draw();
      if (t < 1) {
        requestAnimationFrame(animate);
      } else {
        spinning = false; spinBtn.disabled = false;
        showWinner(k);
      }
    })(t0);
  }

  function showWinner(k){
    winnerText.textContent = items[k];
    resultBox.style.display = 'block';
  }

  // ---------- Events ----------
  spinBtn.addEventListener('click', spin);
  shuffleBtn.addEventListener('click', () => { paletteSeed = Math.random(); draw(); });
  updateBtn.addEventListener('click', updateListFromTextarea);
  clearBtn.addEventListener('click', () => { listInput.value = ''; items = []; save(); countEl.textContent='0 items'; draw(); });

  // initialize
  listInput.value = items.join(', ');
  countEl.textContent = `${items.length} items`;
  draw();
})();
</script>
</body>
</html>
